{"version":3,"file":"main.js","sources":["../src/main.js"],"sourcesContent":["// 挂载原型扩展\r\nrequire('./prototype/mount')()\r\n\r\n// 导入creep工作逻辑\r\nimport { doBuilder } from './roles/builder'\r\nimport { doHarvester } from './roles/harvester'\r\nimport { doUpgrader } from './roles/upgrader'\r\nimport { doPioneer } from './roles/pioneer'\r\nimport { doCarrier } from './roles/carrier'\r\n\r\n// 初始化\r\nfor (var room in Game.rooms) {\r\n    Game.rooms[room].initMemory();\r\n}\r\n\r\nexport const loop = function () {\r\n\r\n    // 检查CPU是否足够\r\n    if (Game.time > 1000 && Game.cpu.bucket < 1.5 * Game.cpu.tickLimit && Game.cpu.bucket < Game.cpu.limit * 10) {\r\n        console.log(`${Game.time} Skipping tick CPU Bucket too low. bucket: ${Game.cpu.bucket} tickLimit: ${Game.cpu.tickLimit} limit: ${Game.cpu.limit}`);\r\n        return;\r\n    }\r\n\r\n    // 更新各房间creep配置\r\n    if (Game.time % 200 === 0) {\r\n        for (var room in Game.rooms) {\r\n            Game.rooms[room].updateCreepConfig();\r\n        }\r\n    }\r\n    \r\n    // 统计creep数量\r\n    const creepCountByBase = {};\r\n    for (const name in Game.creeps) {\r\n        const creep = Game.creeps[name];\r\n        const base = creep.memory.base;\r\n        if (!creepCountByBase[base]) {\r\n            creepCountByBase[base] = {};\r\n        }\r\n        if (!creepCountByBase[base][creep.memory.role]) {\r\n            creepCountByBase[base][creep.memory.role] = 0;\r\n        }\r\n        creepCountByBase[base][creep.memory.role]++;\r\n    }\r\n\r\n    // 维护各房间spawnList\r\n    for (var room in Game.rooms) {\r\n        Game.rooms[room].updateSpawnList(creepCountByBase[room] || {});\r\n    }\r\n\r\n    // 执行spawn逻辑\r\n    for (var spawn in Game.spawns) {\r\n        Game.spawns[spawn].trySpawn();\r\n    }\r\n\r\n    // 执行creep逻辑\r\n    for (var name in Game.creeps) {\r\n        const creep = Game.creeps[name];\r\n        switch (creep.memory.role) {\r\n            case 'builder':\r\n                doBuilder(creep);\r\n                break;\r\n            case 'harvester':\r\n                doHarvester(creep);\r\n                break;\r\n            case 'upgrader':\r\n                doUpgrader(creep);\r\n                break;\r\n            case 'pioneer':\r\n                doPioneer(creep);\r\n                break;\r\n            case 'carrier':\r\n                doCarrier(creep);\r\n                break;\r\n            default:\r\n                console.log(`Unknown role ${creep.memory.role} for creep ${creep.name}`);\r\n                break;\r\n        }\r\n    }\r\n}"],"names":[],"mappings":"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"}